# Impresora Local - Sistema de Sincronizaci√≥n Autom√°tica

Sistema de impresi√≥n de tickets para cocina y parrilla con sincronizaci√≥n autom√°tica entre servidor y cliente.

## üöÄ Caracter√≠sticas

- **Impresi√≥n autom√°tica** de tickets para cocina y parrilla
- **Sincronizaci√≥n autom√°tica** cada 5 minutos desde GitHub
- **Gesti√≥n de procesos** con PM2
- **Reinicio autom√°tico** del servicio despu√©s de actualizaciones
- **Logs detallados** de todas las operaciones
- **Configuraci√≥n persistente** entre actualizaciones

## üìã Requisitos

### En tu PC (Servidor de Desarrollo)
- Git configurado con acceso a GitHub
- Node.js 18+ instalado
- Acceso a internet para subir cambios

### En la PC del Cliente
- Linux (Ubuntu/Debian, CentOS/RHEL, Fedora)
- Acceso a internet para descargar actualizaciones
- Permisos de administrador (sudo)

## üõ†Ô∏è Instalaci√≥n

### 1. Configuraci√≥n Inicial en tu PC

1. **Clonar el repositorio existente:**
   ```bash
   # Clonar el repositorio existente
   git clone https://github.com/francoluca35/impresora-local.git
   cd impresora-local
   ```

2. **Copiar archivos del proyecto:**
   ```bash
   # Copiar todos los archivos de tu proyecto actual
   cp -r /ruta/a/tu/proyecto/* .
   ```

3. **Configurar Git:**
   ```bash
   git add .
   git commit -m "Configuraci√≥n inicial"
   git push origin main
   ```

### 2. Configuraci√≥n en la PC del Cliente

1. **Descargar y ejecutar el script de configuraci√≥n:**
   ```bash
   # Descargar el script
   wget https://raw.githubusercontent.com/francoluca35/impresora-local/main/setup-cliente.sh
   
   # Dar permisos de ejecuci√≥n
   chmod +x setup-cliente.sh
   
   # Ejecutar como root
   sudo ./setup-cliente.sh
   ```

2. **El script configurar√° autom√°ticamente:**
   - Usuario del servicio
   - Dependencias del sistema
   - Node.js y PM2
   - Repositorio Git
   - Auto-actualizaci√≥n cada 5 minutos
   - Servicio del sistema

## üîÑ Flujo de Sincronizaci√≥n

### En tu PC (Desarrollo):
1. Hacer cambios en el c√≥digo
2. Ejecutar `./deploy.sh`
3. Los cambios se suben a GitHub autom√°ticamente

### En la PC del Cliente:
1. Cada 5 minutos se verifica si hay cambios
2. Si hay cambios, se descargan autom√°ticamente
3. Se instalan nuevas dependencias si es necesario
4. Se reinicia el servicio PM2
5. Se preserva la configuraci√≥n local

## üìÅ Estructura de Archivos

```
impresora-local/
‚îú‚îÄ‚îÄ index.js              # Servidor principal
‚îú‚îÄ‚îÄ package.json          # Dependencias
‚îú‚îÄ‚îÄ auto-update.sh        # Script de auto-actualizaci√≥n
‚îú‚îÄ‚îÄ deploy.sh             # Script de despliegue
‚îú‚îÄ‚îÄ setup-cliente.sh      # Script de configuraci√≥n del cliente
‚îî‚îÄ‚îÄ README.md             # Este archivo
```

## üéØ Uso

### Desplegar Cambios (Tu PC)
```bash
./deploy.sh
```

### Ver Estado del Servicio (Cliente)
```bash
pm2 status
pm2 logs impresora
```

### Ver Logs de Actualizaci√≥n (Cliente)
```bash
tail -f /var/log/impresora-update.log
```

### Reiniciar Servicio (Cliente)
```bash
pm2 restart impresora
```

## ‚öôÔ∏è Configuraci√≥n

### Personalizar Rutas
Edita los archivos de configuraci√≥n seg√∫n tu entorno:

- **auto-update.sh**: Cambia `REPO_DIR` y `LOG_FILE`
- **setup-cliente.sh**: Cambia `REPO_URL` e `INSTALL_DIR`

### Cambiar Frecuencia de Actualizaci√≥n
En el cliente, edita el crontab:
```bash
crontab -u impresora -e
# Cambiar */5 por el intervalo deseado (ej: */10 para cada 10 minutos)
```

## üîç Monitoreo

### Verificar Estado del Servicio
```bash
systemctl status impresora
pm2 status
```

### Ver Logs en Tiempo Real
```bash
# Logs del servicio
pm2 logs impresora --lines 100

# Logs de actualizaci√≥n
tail -f /var/log/impresora-update.log
```

### Verificar √öltima Actualizaci√≥n
```bash
# Ver √∫ltimo commit
cd /opt/impresora-local/impresora-local
git log -1 --oneline

# Ver estado del repositorio
git status
```

## üö® Soluci√≥n de Problemas

### El servicio no se actualiza
1. Verificar logs: `tail -f /var/log/impresora-update.log`
2. Verificar crontab: `crontab -u impresora -l`
3. Verificar permisos: `ls -la /usr/local/bin/auto-update.sh`

### Error de permisos
```bash
sudo chown -R impresora:impresora /opt/impresora-local
sudo chmod +x /usr/local/bin/auto-update.sh
```

### El servicio no inicia
```bash
pm2 delete impresora
pm2 start index.js --name impresora
pm2 save
```

## üìû Soporte

Si encuentras problemas:

1. Revisa los logs del sistema
2. Verifica la conectividad a internet
3. Confirma que el repositorio GitHub sea accesible
4. Verifica que los scripts tengan permisos de ejecuci√≥n

## üîí Seguridad

- El servicio se ejecuta con un usuario dedicado (`impresora`)
- Los logs se almacenan en `/var/log/`
- Las configuraciones se preservan entre actualizaciones
- Solo se actualiza el c√≥digo, no la configuraci√≥n del sistema

---

**Nota**: Aseg√∫rate de cambiar `tu-usuario` por tu nombre de usuario real de GitHub en todos los archivos de configuraci√≥n.
