# Impresora Local - Sistema de SincronizaciÃ³n AutomÃ¡tica

Sistema de impresiÃ³n de tickets para cocina y parrilla con sincronizaciÃ³n automÃ¡tica entre servidor y cliente.

## ğŸš€ CaracterÃ­sticas

- **ImpresiÃ³n automÃ¡tica** de tickets para cocina y parrilla
- **SincronizaciÃ³n automÃ¡tica** cada 5 minutos desde GitHub
- **GestiÃ³n de procesos** con PM2
- **Reinicio automÃ¡tico** del servicio despuÃ©s de actualizaciones
- **Logs detallados** de todas las operaciones
- **ConfiguraciÃ³n persistente** entre actualizaciones

## ğŸ“‹ Requisitos

### En tu PC (Servidor de Desarrollo)
- Git configurado con acceso a GitHub
- Node.js 18+ instalado
- Acceso a internet para subir cambios

### En la PC del Cliente
- **Linux**: Ubuntu/Debian, CentOS/RHEL, Fedora
- **Windows**: Windows 10/11
- Acceso a internet para descargar actualizaciones
- Permisos de administrador (sudo en Linux, ejecutar como administrador en Windows)

## ğŸ› ï¸ InstalaciÃ³n

### 1. ConfiguraciÃ³n Inicial en tu PC

1. **Clonar el repositorio existente:**
   ```bash
   # Clonar el repositorio existente
   git clone https://github.com/francoluca35/impresora-local.git
   cd impresora-local
   ```

2. **Copiar archivos del proyecto:**
   ```bash
   # Copiar todos los archivos de tu proyecto actual
   cp -r /ruta/a/tu/proyecto/* .
   ```

3. **Configurar Git:**
   ```bash
   git add .
   git commit -m "ConfiguraciÃ³n inicial"
   git push origin main
   ```

### 2. ConfiguraciÃ³n en la PC del Cliente

#### **Para Linux:**
```bash
# Descargar el script
wget https://raw.githubusercontent.com/francoluca35/impresora-local/main/setup-cliente.sh

# Dar permisos de ejecuciÃ³n
chmod +x setup-cliente.sh

# Ejecutar como root
sudo ./setup-cliente.sh
```

#### **Para Windows:**
```cmd
# Descargar el script (ejecutar CMD como administrador)
# Descargar setup-cliente-windows.bat desde GitHub
# O copiarlo desde tu PC

# Ejecutar el script
setup-cliente-windows.bat
```

2. **El script configurarÃ¡ automÃ¡ticamente:**
   - Usuario del servicio
   - Dependencias del sistema
   - Node.js y PM2
   - Repositorio Git
   - Auto-actualizaciÃ³n cada 5 minutos
   - Servicio del sistema

## ğŸ”„ Flujo de SincronizaciÃ³n

### En tu PC (Desarrollo):
1. Hacer cambios en el cÃ³digo
2. Ejecutar `./deploy.sh`
3. Los cambios se suben a GitHub automÃ¡ticamente

### En la PC del Cliente:
1. Cada 5 minutos se verifica si hay cambios
2. Si hay cambios, se descargan automÃ¡ticamente
3. Se instalan nuevas dependencias si es necesario
4. Se reinicia el servicio PM2
5. Se preserva la configuraciÃ³n local

## ğŸ“ Estructura de Archivos

```
impresora-local/
â”œâ”€â”€ index.js                    # Servidor principal
â”œâ”€â”€ package.json                # Dependencias
â”œâ”€â”€ auto-update.sh              # Script de auto-actualizaciÃ³n (Linux)
â”œâ”€â”€ auto-update.bat             # Script de auto-actualizaciÃ³n (Windows)
â”œâ”€â”€ deploy.sh                   # Script de despliegue (Linux)
â”œâ”€â”€ deploy.bat                  # Script de despliegue (Windows)
â”œâ”€â”€ setup-cliente.sh            # Script de configuraciÃ³n del cliente (Linux)
â”œâ”€â”€ setup-cliente-windows.bat   # Script de configuraciÃ³n del cliente (Windows)
â”œâ”€â”€ config.json                 # ConfiguraciÃ³n
â”œâ”€â”€ README.md                   # DocumentaciÃ³n principal
â””â”€â”€ README-Windows.md           # DocumentaciÃ³n especÃ­fica para Windows
```

## ğŸ¯ Uso

### Desplegar Cambios (Tu PC)
```bash
# En Linux/Mac:
./deploy.sh

# En Windows:
deploy.bat
```

### Ver Estado del Servicio (Cliente)
```bash
pm2 status
pm2 logs impresora
```

### Ver Logs de ActualizaciÃ³n (Cliente)
```bash
tail -f /var/log/impresora-update.log
```

### Reiniciar Servicio (Cliente)
```bash
pm2 restart impresora
```

## âš™ï¸ ConfiguraciÃ³n

### Personalizar Rutas
Edita los archivos de configuraciÃ³n segÃºn tu entorno:

- **auto-update.sh**: Cambia `REPO_DIR` y `LOG_FILE`
- **setup-cliente.sh**: Cambia `REPO_URL` e `INSTALL_DIR`

### Cambiar Frecuencia de ActualizaciÃ³n
En el cliente, edita el crontab:
```bash
crontab -u impresora -e
# Cambiar */5 por el intervalo deseado (ej: */10 para cada 10 minutos)
```

## ğŸ” Monitoreo

### Verificar Estado del Servicio
```bash
systemctl status impresora
pm2 status
```

### Ver Logs en Tiempo Real
```bash
# Logs del servicio
pm2 logs impresora --lines 100

# Logs de actualizaciÃ³n
tail -f /var/log/impresora-update.log
```

### Verificar Ãšltima ActualizaciÃ³n
```bash
# Ver Ãºltimo commit
cd /opt/impresora-local/impresora-local
git log -1 --oneline

# Ver estado del repositorio
git status
```

## ğŸš¨ SoluciÃ³n de Problemas

### El servicio no se actualiza
1. Verificar logs: `tail -f /var/log/impresora-update.log`
2. Verificar crontab: `crontab -u impresora -l`
3. Verificar permisos: `ls -la /usr/local/bin/auto-update.sh`

### Error de permisos
```bash
sudo chown -R impresora:impresora /opt/impresora-local
sudo chmod +x /usr/local/bin/auto-update.sh
```

### El servicio no inicia
```bash
pm2 delete impresora
pm2 start index.js --name impresora
pm2 save
```

## ğŸ“ Soporte

Si encuentras problemas:

1. Revisa los logs del sistema
2. Verifica la conectividad a internet
3. Confirma que el repositorio GitHub sea accesible
4. Verifica que los scripts tengan permisos de ejecuciÃ³n

## ğŸ”’ Seguridad

- El servicio se ejecuta con un usuario dedicado (`impresora`)
- Los logs se almacenan en `/var/log/`
- Las configuraciones se preservan entre actualizaciones
- Solo se actualiza el cÃ³digo, no la configuraciÃ³n del sistema

---

**Nota**: El repositorio ya estÃ¡ configurado para usar `francoluca35/impresora-local`.
